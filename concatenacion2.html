<!DOCTYPE html>
<!--
Computación Gráfica:	  Concatenación de transformaciones
Por: 					     Yecid Yamid Sánchez León
Dirigido a: 			  Héctor Murcia Forero
-->
<html>
   <head>
      <title>Concatenación</title>
      <style>
         html, body { margin: 0; padding: 0; overflow: hidden; }
         /*Atributos CSS para el id="info".*/
         #info {
            position: absolute;
            padding: 10px;
            width: 100%;
            text-align: center;
            color: #FFFFFF;
         }
      </style>
   </head>
   <body>
      <div id="info">Concatenación de transformaciones</div>
      <div id="info"><br/><br/>Por: Yecid Sánchez<br/></div>
      <div id="info"><br/><br/><br/>Dirigido a: Hector Murcia<br/></div>
 
      <!-- Importación de la librería Three.js. -->   
      <script src="js/three.min.js"></script>
      <script>
    	//Creación de las variables escena, aspecto, cámara, render y acciones del teclado.
		var scene, aspect, camera, renderer;
		var startTime = Date.now();
		var object;

		//Declaración de las funciones de inicialización y animación.
		init();
		animate();
	
		function init() {
			scene = new THREE.Scene();
			aspect = window.innerWidth / window.innerHeight;
			camera = new THREE.PerspectiveCamera( 45, aspect, 0.1, 1000);
			renderer = new THREE.WebGLRenderer();
			renderer.setSize( window.innerWidth, window.innerHeight );
			document.body.appendChild( renderer.domElement );

			//Elementos de la escena.
			var size = 10;
			var arrowSize = 1;
			var divisions = size;

			//Vector unitario y punto de origen.
			var origin = new THREE.Vector3( 0, 0, 0 );
			var x = new THREE.Vector3( 1, 0, 0 );
			var y = new THREE.Vector3( 0, 1, 0 );
		  	var z = new THREE.Vector3( 0, 0, 1 );

		  	//color1: Para las grillas.
			var color1 = new THREE.Color( 0xFFFFFF );

			//color2: Para el fondo del escenario.
		  	var color2 = new THREE.Color( 0x333333 );

		  	//colorR, colorG, colorB: Para las Flechas de Coordenadas.
		  	var colorR = new THREE.Color( 0xAA0000 );
		  	var colorG = new THREE.Color( 0x00AA00 );
		  	var colorB = new THREE.Color( 0x0000AA );

		  	//Colores de las caras del objeto 3D.
			var colorRd = new THREE.Color( 0xCE3A22 );
		  	var colorGd = new THREE.Color( 0xFDC519 );
		  	var colorBd = new THREE.Color( 0x222C56 );

		  	//Creación de las grillas del escenario.
		  	var axesHelper = new THREE.AxesHelper( size );
		  	var gridHelperXY = new THREE.GridHelper( size, divisions, color1, color1);
		  	var gridHelperXZ = new THREE.GridHelper( size, divisions, color2, color2 );
		  	var gridHelperYZ = new THREE.GridHelper( size, divisions, color2, color2 );

         //Creación de las Flechas de Coordenadas.
         var arrowX = new THREE.ArrowHelper( x, origin, arrowSize, colorR );
         var arrowY = new THREE.ArrowHelper( y, origin, arrowSize, colorG );
         var arrowZ = new THREE.ArrowHelper( z, origin, arrowSize, colorB );

			//Cración de cada una de las caras del cubo.
			geometry = new THREE.BoxGeometry( 1, 1, 1 );
			for ( var i = 0; i < geometry.faces.length; i ++ ) {
			   switch(i) {
   				case 0: 	case 1: geometry.faces[ i ].color = colorRd; break;
   				case 2: 	case 3: geometry.faces[ i ].color = colorRd; break;
   				case 4: 	case 5: geometry.faces[ i ].color = colorGd; break;
   				case 6: 	case 7: geometry.faces[ i ].color = colorGd; break;
   				case 8: 	case 9: geometry.faces[ i ].color = colorBd; break;
   				case 10: 	case 11: geometry.faces[ i ].color = colorBd; break;
			   }				
		   }
             
		   //Creación de los materiales del Objeto 3D.
         var material = new THREE.MeshBasicMaterial( { color: color1, vertexColors: THREE.FaceColors } );

		   ///Creación del objeto.
		   object = new THREE.Mesh( geometry, material );

		   //Agregamos el OBJETO 3D a la escena.
         scene.add( gridHelperXZ );
   		scene.add( arrowX );	
   		scene.add( arrowY );	
   		scene.add( arrowZ );	
   		scene.add( object );

   		//Posicionamiento de la cámara.
   		camera.position.x = 5;
   		camera.position.y = 10;	 
   		camera.position.z = 10;			
   		camera.lookAt( origin );
	   }
    
      //Definición de la función de animación.
      function animate() {
         render();
         requestAnimationFrame( animate );
      }
       
      //Definición de la función de renderizado.
      function render(){
         var dtime = Date.now()-startTime;
   		var tx = 0, ty = 0, tz = 0;
   		var sx = 1, sy = 1, sz = 1;	

      	//Matrices de transformación.
      	//Matriz de Escalado.
      	var s = new THREE.Matrix4();
      		s.set(sx, 0,  0,  0,
      				0,  sy, 0,  0, 
      				0,  0,  sz, 0,
      				0,  0,  0,  1);	
      		//Aplicar la matriz de Escalado al objeto.
      		object.applyMatrix(s);

      	//Matriz de Traslación.
      	var t = new THREE.Matrix4();
      		t.set(1, 0, 0, tx,
      				0, 1, 0, ty, 
      				0, 0, 1, tz,
      				0, 0, 0, 1);
      		//Aplicar la matriz de Traslación al objeto.
      		object.applyMatrix(t);

      	//Matriz de Concatenación.
      	var c = new THREE.Matrix4();
      		c.set(sx, 0,  0, 	sx*tx,
      				0,  sy, 0, 	sy*ty, 
      				0,  0,  sz, sz*tz,
      				0,  0,  0, 	1);	
      		//Aplicar la matriz de Concatenación al objeto.
      		object.applyMatrix(c);

      	  //Avisar que la matriz del objeto ha cambiado.
      	  object.elementsNeedUpdate = true;	
            camera.lookAt( 0, 0, 0 );
            renderer.render( scene, camera );
      }
      </script>
   </body>
</html>